<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nail Master App</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .stamp-active { background: linear-gradient(135deg, #f472b6, #a855f7); color: white; border: none; }
        .stamp-empty { border: 2px dashed #d1d5db; color: transparent; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #ec4899; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;
    
    // =================================================================
    // üëáüëáüëá –ù–ê–°–¢–†–û–ô–ö–ò (–ó–ê–ü–û–õ–ù–ò –≠–¢–û!) üëáüëáüëá
    // =================================================================
    
    const TG_BOT_TOKEN = "8581694314:AAFyOqGsKdAANCy_WuOtrP_8O6th-Tqne4k"; 
    const TG_CHAT_ID = "6744712545";  
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwK-aDaQ6DbtKR9xHUyg-srLw-ga9eSmcFXjkoH4BdISeil1Tk8m7qrSqyUgJidbtGwTQ/exec"; 
    const ADMIN_PASSWORD = "admin"; // üëà –ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É

    // =================================================================

    const IconCheck = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
    const IconClock = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
    const IconGift = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 12 20 22 4 22 4 12"></polyline><rect x="2" y="7" width="20" height="5"></rect><line x1="12" y1="22" x2="12" y2="7"></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path></svg>;

    const App = () => {
        const tg = window.Telegram.WebApp;
        const userTelegramId = tg.initDataUnsafe?.user?.id;
        // –ü—Ä–æ–≤–µ—Ä–∫–∞: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π —é–∑–µ—Ä –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –±–æ—Ç–∞
        const isOwner = String(userTelegramId) === String(TG_CHAT_ID);

        useEffect(() => { tg.expand(); tg.ready(); }, []);

        // --- –°–û–°–¢–û–Ø–ù–ò–ï ---
        const [view, setView] = useState('login'); 
        const [currentUser, setCurrentUser] = useState(null);
        const [bookings, setBookings] = useState([]); 
        const [loading, setLoading] = useState(false); 

        // –õ–æ–∫–∞–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –≤—Ö–æ–¥–∞)
        const [clients, setClients] = useState(() => {
            const saved = localStorage.getItem('clients');
            return saved ? JSON.parse(saved) : [];
        });
        useEffect(() => localStorage.setItem('clients', JSON.stringify(clients)), [clients]);

        // –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç address
        const [loginForm, setLoginForm] = useState({ name: '', phone: '', address: '' });
        const [adminPass, setAdminPass] = useState('');

        const schedule = {
            '–ü–Ω': ['10:00', '12:00', '14:00', '16:00'],
            '–í—Ç': ['10:00', '12:00', '14:00', '16:00'],
            '–°—Ä': ['10:00', '12:00', '14:00', '16:00'],
            '–ß—Ç': ['10:00', '12:00', '14:00', '16:00'],
            '–ü—Ç': ['10:00', '12:00', '14:00'],
        };

        // --- –§–£–ù–ö–¶–ò–ò –°–í–Ø–ó–ò –° GOOGLE ---

        // 1. –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•
        const fetchBookings = async () => {
            setLoading(true);
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const data = await response.json();
                setBookings(data); 
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
            }
            setLoading(false);
        };

        useEffect(() => { fetchBookings(); }, []);

        // 2. –°–û–ó–î–ê–ù–ò–ï –ó–ê–ü–ò–°–ò
        const createBooking = async (day, time) => {
            setLoading(true);
            const bookingId = Date.now();
            
            // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É)
            const newBooking = {
                id: bookingId,
                name: currentUser.name,
                phone: currentUser.phone,
                address: currentUser.address, // ‚úÖ –ê–¥—Ä–µ—Å
                day, time, status: 'pending'
            };
            setBookings([...bookings, newBooking]);
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Google Script
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({
                        action: 'create',
                        id: bookingId,
                        name: currentUser.name,
                        phone: currentUser.phone,
                        address: currentUser.address, // ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å
                        day, time
                    })
                });
                alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
            } catch(e) { alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"); }
            
            setLoading(false);
            setView('client');
        };

        // 3. –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï (–ê–î–ú–ò–ù)
        const confirmBooking = async (bookingId) => {
            setLoading(true);
            const updated = bookings.map(b => String(b.id) === String(bookingId) ? { ...b, status: 'confirmed' } : b);
            setBookings(updated);

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ action: 'confirm', id: bookingId })
                });
            } catch(e) {}
            setLoading(false);
        };

        // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---

        const handleClientLogin = () => {
            if (!loginForm.name || !loginForm.phone || !loginForm.address) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ò–º—è, –¢–µ–ª–µ—Ñ–æ–Ω –∏ –ê–¥—Ä–µ—Å");
            
            let user = clients.find(c => c.phone === loginForm.phone);
            if (!user) {
                user = { id: Date.now(), ...loginForm, stamps: 0 };
                setClients([...clients, user]);
            } else {
                user.address = loginForm.address; // –û–±–Ω–æ–≤–ª—è–µ–º –∞–¥—Ä–µ—Å, –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è
                user.name = loginForm.name;
            }
            setCurrentUser(user);
            setView('client');
        };

        const handleAdminLogin = () => {
            if (adminPass === ADMIN_PASSWORD) {
                fetchBookings(); 
                setView('admin');
            } else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
        };

        const addStamp = (clientId) => {
            const updatedClients = clients.map(c => {
                if (c.id === clientId) return { ...c, stamps: c.stamps >= 6 ? 0 : c.stamps + 1 };
                return c;
            });
            setClients(updatedClients);
        };

        // --- –≠–ö–†–ê–ù–´ ---

        if (view === 'login') {
            return (
                <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-pink-100 to-purple-200">
                    <div className="glass p-8 rounded-3xl w-full max-w-sm shadow-xl text-center">
                        <div className="text-6xl mb-4">üíÖ</div>
                        <h1 className="text-2xl font-bold mb-6 text-gray-800">Nail Master</h1>
                        
                        <div className="space-y-4">
                            {isOwner && <p className="text-green-600 font-bold text-sm">üëã –ü—Ä–∏–≤–µ—Ç, –ê–¥–º–∏–Ω!</p>}
                            
                            <input placeholder="–í–∞—à–µ –ò–º—è" value={loginForm.name} onChange={e => setLoginForm({...loginForm, name: e.target.value})} className="w-full p-3 rounded-xl border border-pink-200 outline-none focus:ring-2 focus:ring-pink-400"/>
                            
                            <input placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value={loginForm.phone} onChange={e => setLoginForm({...loginForm, phone: e.target.value})} className="w-full p-3 rounded-xl border border-pink-200 outline-none focus:ring-2 focus:ring-pink-400"/>
                            
                            {/* üëá –ü–û–õ–ï –ê–î–†–ï–°–ê üëá */}
                            <input placeholder="–í–∞—à –ê–¥—Ä–µ—Å (–£–ª–∏—Ü–∞, –î–æ–º, –ö–≤)" value={loginForm.address} onChange={e => setLoginForm({...loginForm, address: e.target.value})} className="w-full p-3 rounded-xl border border-pink-200 outline-none focus:ring-2 focus:ring-pink-400"/>
                            
                            <button onClick={handleClientLogin} className="w-full py-3 bg-pink-500 text-white rounded-xl font-bold shadow-lg hover:bg-pink-600 transition">–í–æ–π—Ç–∏</button>
                        </div>

                        {isOwner && (
                            <div className="mt-8 border-t border-gray-300 pt-4 bg-gray-50 rounded-xl p-4">
                                <p className="text-sm text-gray-500 mb-2 font-bold">üëë –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</p>
                                <div className="flex gap-2">
                                    <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" value={adminPass} onChange={e => setAdminPass(e.target.value)} className="w-full p-2 rounded-lg border text-sm"/>
                                    <button onClick={handleAdminLogin} className="px-4 bg-gray-800 text-white rounded-lg text-sm font-bold">‚ûú</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        if (view === 'client') {
            const myBookings = bookings.filter(b => String(b.phone) === String(currentUser.phone));
            
            return (
                <div className="min-h-screen p-4 bg-gray-50 max-w-md mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800">{currentUser.name}</h2>
                            <p className="text-xs text-gray-500">üìç {currentUser.address}</p>
                        </div>
                        <button onClick={() => setView('login')} className="text-sm text-gray-400">–í—ã–π—Ç–∏</button>
                    </div>

                    <div className="bg-white p-6 rounded-3xl shadow-lg mb-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 bg-yellow-400 text-xs font-bold px-3 py-1 rounded-bl-xl">–ê–ö–¶–ò–Ø -50%</div>
                        <h3 className="font-bold text-gray-700 mb-4 flex items-center gap-2"><IconGift /> –ú–æ—è —Å–∫–∏–¥–∫–∞</h3>
                        <div className="grid grid-cols-6 gap-2">
                            {[...Array(6)].map((_, i) => (
                                <div key={i} className={`aspect-square rounded-lg flex items-center justify-center text-lg font-bold transition-all ${i < currentUser.stamps ? 'stamp-active shadow-md scale-105' : 'stamp-empty'}`}>
                                    {i < currentUser.stamps && <IconCheck />}
                                </div>
                            ))}
                        </div>
                        <p className="text-center text-sm text-gray-500 mt-4">{currentUser.stamps >= 6 ? 'üéâ –£ –≤–∞—Å —Å–∫–∏–¥–∫–∞ 50%!' : `–°–æ–±–µ—Ä–∏—Ç–µ –µ—â–µ ${6 - currentUser.stamps} –ø–µ—á–∞—Ç–∏`}</p>
                    </div>

                    <button onClick={() => setView('booking')} className="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl font-bold text-xl shadow-lg mb-6 transform active:scale-95 transition">üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>

                    <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">–ú–æ–∏ –∑–∞–ø–∏—Å–∏ {loading && <div className="loader"></div>}</h3>
                    <div className="space-y-3">
                        {myBookings.length === 0 && <p className="text-gray-400 text-sm">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>}
                        {myBookings.map(b => (
                            <div key={b.id} className="bg-white p-4 rounded-xl shadow-sm flex flex-col gap-1 border-l-4" style={{ borderColor: b.status === 'confirmed' ? '#10b981' : '#f59e0b' }}>
                                <div className="flex justify-between items-center">
                                    <p className="font-bold text-gray-800">{b.day} –≤ {b.time}</p>
                                    <div className={`px-3 py-1 rounded-full text-xs font-bold ${b.status === 'confirmed' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>
                                        {b.status === 'confirmed' ? '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ' : '–û–∂–∏–¥–∞–Ω–∏–µ'}
                                    </div>
                                </div>
                                {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–ø–∏—Å–∏ —Ç–æ–∂–µ */}
                                <p className="text-xs text-gray-400">üìç {b.address}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        if (view === 'booking') {
            return (
                <div className="min-h-screen p-4 bg-gray-50 max-w-md mx-auto">
                    <button onClick={() => setView('client')} className="mb-4 text-gray-500">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2 className="text-2xl font-bold mb-6">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h2>
                    {loading && <div className="flex justify-center mb-4"><div className="loader"></div></div>}
                    <div className="space-y-6">
                        {Object.entries(schedule).map(([day, times]) => (
                            <div key={day} className="bg-white p-4 rounded-2xl shadow-sm">
                                <h3 className="font-bold text-pink-600 mb-3">{day}</h3>
                                <div className="grid grid-cols-4 gap-2">
                                    {times.map(time => {
                                        const isBusy = bookings.some(b => b.day === day && b.time === time);
                                        return (
                                            <button key={time} disabled={isBusy} onClick={() => createBooking(day, time)} 
                                                className={`py-2 rounded-lg text-sm font-semibold ${isBusy ? 'bg-gray-100 text-gray-300' : 'bg-green-50 text-green-600 border border-green-200'}`}>
                                                {time}
                                            </button>
                                        )
                                    })}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        if (view === 'admin') {
            const pending = bookings.filter(b => b.status === 'pending');
            return (
                <div className="min-h-screen p-4 bg-gray-800 text-white max-w-md mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold">–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</h2>
                        <div className="flex gap-4 items-center">
                            {loading && <div className="loader"></div>}
                            <button onClick={() => setView('login')} className="text-sm text-gray-400">–í—ã–π—Ç–∏</button>
                        </div>
                    </div>

                    <div className="mb-8">
                        <h3 className="text-yellow-400 font-bold mb-3 flex items-center gap-2"><IconClock /> –ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ ({pending.length})</h3>
                        <button onClick={fetchBookings} className="text-xs text-blue-300 mb-2 underline">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                        <div className="space-y-3">
                            {pending.length === 0 && <p className="text-gray-500 text-sm">–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫</p>}
                            {pending.map(b => (
                                <div key={b.id} className="bg-gray-700 p-4 rounded-xl">
                                    <p className="font-bold text-lg">{b.name}</p>
                                    <p className="text-sm text-gray-300">üìû {b.phone}</p>
                                    <p className="text-sm text-yellow-300 mb-2">üìç {b.address}</p> 
                                    <p className="text-white font-bold mb-3">üìÖ {b.day} –≤ {b.time}</p>
                                    <button onClick={() => confirmBooking(b.id)} className="w-full py-2 bg-green-500 hover:bg-green-600 rounded-lg font-bold transition">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å ‚úÖ</button>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="mb-8">
                        <h3 className="text-pink-400 font-bold mb-3 flex items-center gap-2"><IconGift /> –ö–ª–∏–µ–Ω—Ç—ã</h3>
                        <div className="bg-gray-700 rounded-xl p-4 space-y-4">
                            {clients.map(c => (
                                <div key={c.id} className="flex justify-between items-center border-b border-gray-600 pb-2 last:border-0">
                                    <div>
                                        <p className="font-bold">{c.name}</p>
                                        <p className="text-xs text-gray-400">{c.phone}</p>
                                        <div className="flex gap-1 mt-1">
                                            {[...Array(6)].map((_, i) => (<div key={i} className={`w-2 h-2 rounded-full ${i < c.stamps ? 'bg-pink-500' : 'bg-gray-500'}`}></div>))}
                                        </div>
                                    </div>
                                    <button onClick={() => addStamp(c.id)} className="px-3 py-1 bg-blue-500 rounded text-sm font-bold">+ –ü–µ—á–∞—Ç—å</button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>


