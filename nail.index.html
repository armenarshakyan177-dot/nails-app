<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nail Master App</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .stamp-active { background: linear-gradient(135deg, #f472b6, #a855f7); color: white; border: none; }
        .stamp-empty { border: 2px dashed #d1d5db; color: transparent; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;
    
    // =================================================================
    // üëáüëáüëá –ù–ê–°–¢–†–û–ô–ö–ò (–ó–ê–ü–û–õ–ù–ò –≠–¢–û!) üëáüëáüëá
    // =================================================================
    
    const TG_BOT_TOKEN = "8581694314:AAFyOqGsKdAANCy_WuOtrP_8O6th-Tqne4k"; 
    const TG_CHAT_ID = "6744712545";  // <--- –í–ê–ñ–ù–û: –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –¢–û–õ–¨–ö–û —É —ç—Ç–æ–≥–æ ID
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyp64kfADN--ddoIrHx8US713BIV4R7B26pFRa6Nbpc3_9HcsEUI3ggjyARgzAzJNnR0w/exec"; 

    // =================================================================

    // –ò–∫–æ–Ω–∫–∏ (SVG)
    const IconCheck = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
    const IconClock = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
    const IconGift = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 12 20 22 4 22 4 12"></polyline><rect x="2" y="7" width="20" height="5"></rect><line x1="12" y1="22" x2="12" y2="7"></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path></svg>;

    const App = () => {
        // --- –ü–û–õ–£–ß–ê–ï–ú ID –ò–ó TELEGRAM ---
        const tg = window.Telegram.WebApp;
        const userTelegramId = tg.initDataUnsafe?.user?.id;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º: —ç—Ç–æ –ê–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–µ—Ç?
        // (–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º ID –∏–∑ –¢–µ–ª–µ–≥—Ä–∞–º–∞ —Å —Ç–µ–º, —á—Ç–æ —Ç—ã –≤–ø–∏—Å–∞–ª –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö)
        const isOwner = String(userTelegramId) === String(TG_CHAT_ID);

        useEffect(() => {
            tg.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.ready();
        }, []);

        // --- –°–û–°–¢–û–Ø–ù–ò–ï ---
        const [view, setView] = useState('login'); 
        const [currentUser, setCurrentUser] = useState(null);
        
        // –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (LocalStorage)
        const [clients, setClients] = useState(() => {
            const saved = localStorage.getItem('clients');
            return saved ? JSON.parse(saved) : [];
        });
        const [bookings, setBookings] = useState(() => {
            const saved = localStorage.getItem('bookings');
            return saved ? JSON.parse(saved) : [];
        });

        useEffect(() => localStorage.setItem('clients', JSON.stringify(clients)), [clients]);
        useEffect(() => localStorage.setItem('bookings', JSON.stringify(bookings)), [bookings]);

        const [loginForm, setLoginForm] = useState({ name: '', phone: '' });
        const [adminPass, setAdminPass] = useState('');

        const schedule = {
            '–ü–Ω': ['10:00', '12:00', '14:00', '16:00'],
            '–í—Ç': ['10:00', '12:00', '14:00', '16:00'],
            '–°—Ä': ['10:00', '12:00', '14:00', '16:00'],
            '–ß—Ç': ['10:00', '12:00', '14:00', '16:00'],
            '–ü—Ç': ['10:00', '12:00', '14:00'],
        };

        // --- –õ–û–ì–ò–ö–ê ---

        const handleClientLogin = () => {
            if (!loginForm.name || !loginForm.phone) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω");
            let user = clients.find(c => c.phone === loginForm.phone);
            if (!user) {
                user = { id: Date.now(), name: loginForm.name, phone: loginForm.phone, stamps: 0 };
                setClients([...clients, user]);
            }
            setCurrentUser(user);
            setView('client');
        };

        const handleAdminLogin = () => {
            if (adminPass === 'admin') setView('admin');
            else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
        };

        const createBooking = async (day, time) => {
            const newBooking = {
                id: Date.now(),
                clientId: currentUser.id,
                clientName: currentUser.name,
                day,
                time,
                status: 'pending'
            };
            setBookings([...bookings, newBooking]);
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
            const msg = `üíÖ *–ó–ê–Ø–í–ö–ê!* \nüë§ ${currentUser.name}\nüìû ${currentUser.phone}\nüìÖ ${day} –≤ ${time}`;
            if (TG_BOT_TOKEN !== "–í–°–¢–ê–í–¨_–¢–û–ö–ï–ù_–ë–û–¢–ê") {
                try {
                    await fetch(`https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ chat_id: TG_CHAT_ID, text: msg, parse_mode: 'Markdown' })
                    });
                } catch(e) {}
            }
            alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
            setView('client');
        };

        const confirmBooking = (bookingId) => {
            const updated = bookings.map(b => b.id === bookingId ? { ...b, status: 'confirmed' } : b);
            setBookings(updated);
        };

        const addStamp = (clientId) => {
            const updatedClients = clients.map(c => {
                if (c.id === clientId) return { ...c, stamps: c.stamps >= 6 ? 0 : c.stamps + 1 };
                return c;
            });
            setClients(updatedClients);
        };

        // --- –≠–ö–†–ê–ù–´ ---

        // 1. –õ–û–ì–ò–ù
        if (view === 'login') {
            return (
                <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-pink-100 to-purple-200">
                    <div className="glass p-8 rounded-3xl w-full max-w-sm shadow-xl text-center">
                        <div className="text-6xl mb-4">üíÖ</div>
                        <h1 className="text-2xl font-bold mb-6 text-gray-800">Nail Master</h1>
                        
                        <div className="space-y-4">
                            {/* –ï—Å–ª–∏ –∑–∞—à–µ–ª –ê–î–ú–ò–ù (–ø–æ ID), –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–º—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –Ω–æ –ª–æ–≥–∏–Ω–∏—Ç—Å—è –æ–Ω –º–æ–∂–µ—Ç –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∞ */}
                            {isOwner && <p className="text-green-600 font-bold text-sm">üëã –ü—Ä–∏–≤–µ—Ç, –ê–¥–º–∏–Ω!</p>}
                            
                            <input 
                                placeholder="–í–∞—à–µ –ò–º—è" 
                                value={loginForm.name}
                                onChange={e => setLoginForm({...loginForm, name: e.target.value})}
                                className="w-full p-3 rounded-xl border border-pink-200 outline-none focus:ring-2 focus:ring-pink-400"
                            />
                            <input 
                                placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" 
                                value={loginForm.phone}
                                onChange={e => setLoginForm({...loginForm, phone: e.target.value})}
                                className="w-full p-3 rounded-xl border border-pink-200 outline-none focus:ring-2 focus:ring-pink-400"
                            />
                            <button onClick={handleClientLogin} className="w-full py-3 bg-pink-500 text-white rounded-xl font-bold shadow-lg hover:bg-pink-600 transition">
                                –í–æ–π—Ç–∏ –∫–∞–∫ –ö–ª–∏–µ–Ω—Ç
                            </button>
                        </div>

                        {/* üî• –≠–¢–û–¢ –ë–õ–û–ö –í–ò–î–ò–¢ –¢–û–õ–¨–ö–û –í–õ–ê–î–ï–õ–ï–¶ ID (isOwner) üî• */}
                        {isOwner && (
                            <div className="mt-8 border-t border-gray-300 pt-4 bg-gray-50 rounded-xl p-4">
                                <p className="text-sm text-gray-500 mb-2 font-bold">üëë –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
                                <div className="flex gap-2">
                                    <input 
                                        type="password"
                                        placeholder="–ü–∞—Ä–æ–ª—å (admin)" 
                                        value={adminPass}
                                        onChange={e => setAdminPass(e.target.value)}
                                        className="w-full p-2 rounded-lg border text-sm"
                                    />
                                    <button onClick={handleAdminLogin} className="px-4 bg-gray-800 text-white rounded-lg text-sm font-bold">‚ûú</button>
                                </div>
                            </div>
                        )}
                        
                    </div>
                </div>
            );
        }

        // 2. –ö–ê–ë–ò–ù–ï–¢ –ö–õ–ò–ï–ù–¢–ê (–û—Å—Ç–∞–ª—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        if (view === 'client') {
            const myBookings = bookings.filter(b => b.clientId === currentUser.id);
            return (
                <div className="min-h-screen p-4 bg-gray-50 max-w-md mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800">–ü—Ä–∏–≤–µ—Ç, {currentUser.name}!</h2>
                        <button onClick={() => setView('login')} className="text-sm text-gray-400">–í—ã–π—Ç–∏</button>
                    </div>

                    <div className="bg-white p-6 rounded-3xl shadow-lg mb-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 bg-yellow-400 text-xs font-bold px-3 py-1 rounded-bl-xl">–ê–ö–¶–ò–Ø -50%</div>
                        <h3 className="font-bold text-gray-700 mb-4 flex items-center gap-2">
                            <IconGift /> –ú–æ—è —Å–∫–∏–¥–∫–∞
                        </h3>
                        <div className="grid grid-cols-6 gap-2">
                            {[...Array(6)].map((_, i) => (
                                <div key={i} className={`aspect-square rounded-lg flex items-center justify-center text-lg font-bold transition-all ${
                                    i < currentUser.stamps ? 'stamp-active shadow-md scale-105' : 'stamp-empty'
                                }`}>
                                    {i < currentUser.stamps && <IconCheck />}
                                </div>
                            ))}
                        </div>
                        <p className="text-center text-sm text-gray-500 mt-4">
                            {currentUser.stamps >= 6 ? 'üéâ –£ –≤–∞—Å —Å–∫–∏–¥–∫–∞ 50%!' : `–°–æ–±–µ—Ä–∏—Ç–µ –µ—â–µ ${6 - currentUser.stamps} –ø–µ—á–∞—Ç–∏`}
                        </p>
                    </div>

                    <button onClick={() => setView('booking')} className="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl font-bold text-xl shadow-lg mb-6 transform active:scale-95 transition">
                        üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
                    </button>

                    <h3 className="font-bold text-gray-700 mb-3">–ú–æ–∏ –∑–∞–ø–∏—Å–∏</h3>
                    <div className="space-y-3">
                        {myBookings.length === 0 && <p className="text-gray-400 text-sm">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>}
                        {myBookings.map(b => (
                            <div key={b.id} className="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center border-l-4" 
                                 style={{ borderColor: b.status === 'confirmed' ? '#10b981' : '#f59e0b' }}>
                                <div>
                                    <p className="font-bold text-gray-800">{b.day} –≤ {b.time}</p>
                                </div>
                                <div className={`px-3 py-1 rounded-full text-xs font-bold ${
                                    b.status === 'confirmed' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'
                                }`}>
                                    {b.status === 'confirmed' ? '–ì–æ—Ç–æ–≤–æ' : '–ñ–¥–µ–º'}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // 3. –í–´–ë–û–† –í–†–ï–ú–ï–ù–ò
        if (view === 'booking') {
            return (
                <div className="min-h-screen p-4 bg-gray-50 max-w-md mx-auto">
                    <button onClick={() => setView('client')} className="mb-4 text-gray-500">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2 className="text-2xl font-bold mb-6">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h2>
                    <div className="space-y-6">
                        {Object.entries(schedule).map(([day, times]) => (
                            <div key={day} className="bg-white p-4 rounded-2xl shadow-sm">
                                <h3 className="font-bold text-pink-600 mb-3">{day}</h3>
                                <div className="grid grid-cols-4 gap-2">
                                    {times.map(time => {
                                        const isBusy = bookings.some(b => b.day === day && b.time === time);
                                        return (
                                            <button 
                                                key={time} disabled={isBusy}
                                                onClick={() => createBooking(day, time)}
                                                className={`py-2 rounded-lg text-sm font-semibold ${
                                                    isBusy ? 'bg-gray-100 text-gray-300' : 'bg-green-50 text-green-600 border border-green-200'
                                                }`}
                                            >
                                                {time}
                                            </button>
                                        )
                                    })}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // 4. –ö–ê–ë–ò–ù–ï–¢ –ê–î–ú–ò–ù–ê
        if (view === 'admin') {
            const pending = bookings.filter(b => b.status === 'pending');
            return (
                <div className="min-h-screen p-4 bg-gray-800 text-white max-w-md mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold">–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</h2>
                        <button onClick={() => setView('login')} className="text-sm text-gray-400">–í—ã–π—Ç–∏</button>
                    </div>

                    <div className="mb-8">
                        <h3 className="text-yellow-400 font-bold mb-3 flex items-center gap-2"><IconClock /> –ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ ({pending.length})</h3>
                        <div className="space-y-3">
                            {pending.length === 0 && <p className="text-gray-500 text-sm">–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫</p>}
                            {pending.map(b => (
                                <div key={b.id} className="bg-gray-700 p-4 rounded-xl">
                                    <p className="font-bold text-lg">{b.clientName}</p>
                                    <p className="text-gray-300 mb-3">{b.day} –≤ {b.time}</p>
                                    <button onClick={() => confirmBooking(b.id)} className="w-full py-2 bg-green-500 hover:bg-green-600 rounded-lg font-bold transition">
                                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å ‚úÖ
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="mb-8">
                        <h3 className="text-pink-400 font-bold mb-3 flex items-center gap-2"><IconGift /> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∞–º–∏</h3>
                        <div className="bg-gray-700 rounded-xl p-4 space-y-4">
                            {clients.map(c => (
                                <div key={c.id} className="flex justify-between items-center border-b border-gray-600 pb-2 last:border-0">
                                    <div>
                                        <p className="font-bold">{c.name}</p>
                                        <div className="flex gap-1 mt-1">
                                            {[...Array(6)].map((_, i) => (
                                                <div key={i} className={`w-2 h-2 rounded-full ${i < c.stamps ? 'bg-pink-500' : 'bg-gray-500'}`}></div>
                                            ))}
                                        </div>
                                    </div>
                                    <button onClick={() => addStamp(c.id)} className="px-3 py-1 bg-blue-500 rounded text-sm font-bold">+ –ü–µ—á–∞—Ç—å</button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
