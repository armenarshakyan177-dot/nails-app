<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nail Master CyberApp</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Audiowide&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* === üåÜ CYBERPUNK STYLES V3.4 (STABLE) === */
        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: #050510;
            background-image: 
                linear-gradient(rgba(236, 72, 153, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            color: #e0e0ff;
            overflow-x: hidden;
        }

        .font-header { font-family: 'Orbitron', sans-serif; }
        .font-logo { 
            font-family: 'Audiowide', sans-serif; 
            background: linear-gradient(to bottom, #ffd700, #ffb700, #c92a2a);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0px 0px 5px rgba(201, 42, 42, 0.5));
        }

        .cyber-card {
            background: rgba(15, 15, 30, 0.95);
            border: 1px solid rgba(236, 72, 153, 0.3);
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #ec4899, #8b5cf6);
            color: white; font-family: 'Orbitron', sans-serif; text-transform: uppercase;
            box-shadow: 0 0 10px rgba(236, 72, 153, 0.5); border: none;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .btn-outline {
            background: transparent; border: 1px solid #06b6d4; color: #06b6d4;
            font-family: 'Orbitron', sans-serif;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ Telegram */
        .btn-telegram {
            background: #229ED9; color: white; border-radius: 8px; font-weight: bold; font-size: 12px;
            display: flex; align-items: center; gap: 6px; padding: 6px 12px;
            text-decoration: none; border: 1px solid #1a8bc0;
            box-shadow: 0 0 10px rgba(34, 158, 217, 0.4);
            transition: transform 0.1s;
        }
        .btn-telegram:active { transform: scale(0.95); }

        .cyber-input {
            background: rgba(0, 0, 0, 0.6) !important;
            border: 1px solid #333 !important;
            border-bottom: 2px solid #ec4899 !important;
            color: white !important;
            font-family: 'Orbitron', monospace;
        }

        .loader { border: 3px solid #333; border-top: 3px solid #ec4899; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .gallery-scroll { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; scrollbar-width: none; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    
    // =================================================================
    // ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò
    // =================================================================
    const TG_BOT_TOKEN = "8581694314:AAFyOqGsKdAANCy_WuOtrP_8O6th-Tqne4k"; 
    const TG_CHAT_ID = "6744712545";  
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwK-aDaQ6DbtKR9xHUyg-srLw-ga9eSmcFXjkoH4BdISeil1Tk8m7qrSqyUgJidbtGwTQ/exec"; 
    const ADMIN_PASSWORD = "admin";

    // =================================================================
    // üñºÔ∏è –ö–û–ù–¢–ï–ù–¢
    // =================================================================
    
    const PRICES = [
        { name: "–ú–∞–Ω–∏–∫—é—Ä (–í—Å—ë –≤–∫–ª—é—á–µ–Ω–æ)", price: "2000‚ÇΩ" },
        { name: "–ü–µ–¥–∏–∫—é—Ä (Smart)", price: "2500‚ÇΩ" },
        { name: "–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ", price: "3000‚ÇΩ" },
        { name: "–î–∏–∑–∞–π–Ω (1 –Ω–æ–≥–æ—Ç—å)", price: "100‚ÇΩ" },
        { name: "–°–Ω—è—Ç–∏–µ –±–µ–∑ –ø–æ–∫—Ä—ã—Ç–∏—è", price: "500‚ÇΩ" }
    ];

    const GALLERY_IMAGES = [
        "https://images.unsplash.com/photo-1604654894610-df63bc536371?auto=format&fit=crop&w=400&q=80",
        "https://images.unsplash.com/photo-1632922267756-9b71242b1592?auto=format&fit=crop&w=400&q=80",
        "https://images.unsplash.com/photo-1522337360705-8754d8722b39?auto=format&fit=crop&w=400&q=80"
    ];

    // =================================================================

    const Icon = ({ name }) => {
        if(name === 'check') return <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        if(name === 'trash') return <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        // –ò–∫–æ–Ω–∫–∞ Telegram (–°–∞–º–æ–ª–µ—Ç–∏–∫)
        if(name === 'telegram') return <svg width="16" height="16" viewBox="0 0 24 24" fill="white" stroke="none"><path d="M20.665 3.717l-17.73 6.837c-1.21.486-1.203 1.161-.222 1.462l4.552 1.42 10.532-6.645c.498-.303.953-.14.579.192l-8.533 7.701h-.002l-.002.001-.314 4.692c.46 0 .663-.211.921-.46l2.211-2.15 4.599 3.397c.848.467 1.457.227 1.668-.785l3.019-14.228c.309-1.239-.473-1.8-1.282-1.432z"/></svg>;
        return null;
    };

    const App = () => {
        const tg = window.Telegram.WebApp;
        const userTelegramId = tg.initDataUnsafe?.user?.id;
        const isOwner = String(userTelegramId) === String(TG_CHAT_ID);

        useEffect(() => { 
            tg.expand(); tg.ready(); 
            tg.setHeaderColor('#050510'); tg.setBackgroundColor('#050510');
        }, []);

        const [view, setView] = useState('login'); 
        const [currentUser, setCurrentUser] = useState(null);
        const [bookings, setBookings] = useState([]); 
        const [loading, setLoading] = useState(false); 
        const [loginForm, setLoginForm] = useState({ name: '', phone: '', address: '' });
        const [adminPass, setAdminPass] = useState('');
        
        // --- ‚ö° –í–ê–ñ–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ó–ê–ü–ò–°–ò ‚ö° ---
        const [selectedService, setSelectedService] = useState('–ú–∞–Ω–∏–∫—é—Ä'); 
        const [showPrice, setShowPrice] = useState(false);

        const generateSchedule = () => {
            const times = ['10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00'];
            return { '–ü–Ω': times, '–í—Ç': times, '–°—Ä': times, '–ß—Ç': times, '–ü—Ç': times, '–°–±': times, '–í—Å': times };
        };
        const schedule = generateSchedule();

        const fetchBookings = async () => {
            setLoading(true);
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const data = await response.json();
                if(Array.isArray(data)) {
                    setBookings(data); 
                }
            } catch (error) { console.error("Err", error); }
            setLoading(false);
        };
        useEffect(() => { fetchBookings(); }, []);

        const createBooking = async (day, time, isBonus = false, customPhone = null, customName = null) => {
            setLoading(true);
            const bookingId = Date.now();
            const useName = customName || currentUser.name;
            const usePhone = customPhone || currentUser.phone;
            const useAddress = currentUser ? currentUser.address : "–ë–æ–Ω—É—Å";
            const useService = isBonus ? "–ë–û–ù–£–°" : (selectedService || '–ú–∞–Ω–∏–∫—é—Ä'); 

            const newBooking = { id: bookingId, name: useName, phone: usePhone, address: useAddress, day, time, service: useService, status: 'pending' };
            setBookings(prev => [...prev, newBooking]);
            
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors',
                    body: JSON.stringify({ 
                        action: 'create', id: bookingId, name: useName, phone: usePhone, address: useAddress, 
                        day, time, service: useService 
                    })
                });
                if(!isBonus) alert("–ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞! ‚úÖ");
            } catch(e) { alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"); }
            setLoading(false);
            if(!isBonus) setView('client');
        };

        const updateBookingStatus = async (bookingId, action) => {
            setLoading(true);
            if (action === 'delete') {
                setBookings(prev => prev.filter(b => String(b.id) !== String(bookingId)));
            } else {
                setBookings(prev => prev.map(b => String(b.id) === String(bookingId) ? { ...b, status: 'confirmed' } : b));
            }
            try {
                await fetch(GOOGLE_SCRIPT_URL, { 
                    method: 'POST', mode: 'no-cors', 
                    body: JSON.stringify({ action: action, id: bookingId }) 
                });
            } catch(e) {}
            setLoading(false);
        };

        const calculateStamps = (phone) => {
            if (!phone) return 0;
            return bookings.filter(b => b && String(b.phone) === String(phone) && b.status === 'confirmed').length % 6;
        };

        const getTelegramLink = (phone) => {
            const cleanPhone = phone.replace(/\D/g, ''); 
            return `https://t.me/+${cleanPhone}`;
        };

        // --- RENDER ---

        if (view === 'login') {
            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="cyber-card p-8 w-full max-w-sm text-center relative overflow-hidden fade-in">
                        <div className="mb-6 mt-2 relative inline-block">
                            <img src="./logo.png" alt="Logo" className="w-32 h-32 object-cover rounded-full border-2 border-pink-500 shadow-[0_0_20px_rgba(236,72,153,0.6)] mx-auto" />
                        </div>
                        <h1 className="text-4xl font-bold mb-1 font-logo">NAIL MASTER</h1>
                        <span className="block text-xs text-cyan-300 mb-8 font-header opacity-70 tracking-widest">SYSTEM V.3.4</span>
                        
                        <div className="space-y-4 relative z-10">
                            <input placeholder="–ò–ú–Ø" value={loginForm.name} onChange={e => setLoginForm({...loginForm, name: e.target.value})} className="w-full p-3 cyber-input rounded"/>
                            <input type="tel" placeholder="–¢–ï–õ–ï–§–û–ù" value={loginForm.phone} onChange={e => setLoginForm({...loginForm, phone: e.target.value})} className="w-full p-3 cyber-input rounded"/>
                            <input placeholder="–ê–î–†–ï–°" value={loginForm.address} onChange={e => setLoginForm({...loginForm, address: e.target.value})} className="w-full p-3 cyber-input rounded"/>
                            <button onClick={handleClientLogin} className="w-full py-4 mt-2 btn-primary rounded text-lg font-bold">–í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£</button>
                        </div>
                        
                        {isOwner && (
                            <div className="mt-8 pt-4 border-t border-gray-700 flex gap-2">
                                <input type="password" placeholder="Pass" value={adminPass} onChange={e => setAdminPass(e.target.value)} className="w-full p-2 bg-transparent border border-gray-700 text-xs text-white"/>
                                <button onClick={() => { if(adminPass===ADMIN_PASSWORD) {fetchBookings(); setView('admin');} }} className="px-4 bg-gray-800 text-white text-xs">GO</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        if (view === 'client') {
            const myBookings = bookings.filter(b => b && String(b.phone) === String(currentUser.phone));
            const myStamps = calculateStamps(currentUser.phone);
            return (
                <div className="min-h-screen p-4 pb-20 max-w-md mx-auto fade-in">
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h2 className="text-xl font-bold font-header text-white">{currentUser.name}</h2>
                            <p className="text-xs text-cyan-400">üìç {currentUser.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                        </div>
                        <button onClick={() => setView('login')} className="text-xs text-pink-500 border border-pink-500 px-3 py-1 rounded">EXIT</button>
                    </div>

                    <div className="mb-6">
                        <h3 className="text-sm font-bold text-gray-400 mb-2 font-header">–ú–û–ò –†–ê–ë–û–¢–´</h3>
                        <div className="gallery-scroll">
                            {GALLERY_IMAGES.map((img, i) => (
                                <img key={i} src={img} className="h-32 w-32 object-cover rounded-xl border border-gray-700 flex-shrink-0" />
                            ))}
                        </div>
                    </div>

                    <div className="cyber-card p-5 mb-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 bg-yellow-500 text-black text-[10px] font-bold px-2 py-1 rounded-bl">BONUS</div>
                        <h3 className="font-bold text-pink-400 mb-4 font-header flex items-center gap-2">LOYALTY CARD</h3>
                        <div className="flex justify-between gap-1">
                            {[...Array(6)].map((_, i) => (
                                <div key={i} className={`h-10 w-full rounded flex items-center justify-center border border-pink-900 ${i < myStamps ? 'bg-pink-600 shadow-[0_0_10px_#db2777]' : 'bg-gray-900'}`}>
                                    {i < myStamps && <Icon name="check" />}
                                </div>
                            ))}
                        </div>
                        <p className="text-center text-xs text-gray-400 mt-3 font-mono">
                            {myStamps === 0 && bookings.some(b => b && b.status === 'confirmed') ? '–°–ö–ò–î–ö–ê –ê–ö–¢–ò–í–ù–ê!' : `${6 - myStamps} –¥–æ —Å–∫–∏–¥–∫–∏ 50%`}
                        </p>
                    </div>

                    <div className="grid grid-cols-2 gap-3 mb-6">
                        <button onClick={() => setShowPrice(true)} className="py-3 btn-outline rounded-xl font-bold">üí∞ –ü–†–ê–ô–°</button>
                        <button onClick={() => setView('booking')} className="py-3 btn-primary rounded-xl font-bold">üìÖ –ó–ê–ü–ò–°–¨</button>
                    </div>

                    <h3 className="text-sm font-bold text-gray-400 mb-3 font-header">–ò–°–¢–û–†–ò–Ø –ó–ê–ü–ò–°–ï–ô</h3>
                    <div className="space-y-3">
                        {myBookings.length === 0 && <p className="text-gray-600 text-xs">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>}
                        {myBookings.slice().reverse().map(b => (
                            <div key={b.id} className="bg-gray-900 p-3 rounded-lg border-l-2 border-cyan-500 flex justify-between items-center">
                                <div>
                                    <p className="font-bold text-white text-sm">{b.day} –≤ {b.time}</p>
                                    <p className="text-xs text-pink-400">{b.service || '–ú–∞–Ω–∏–∫—é—Ä'}</p>
                                </div>
                                <div className={`text-[10px] px-2 py-1 rounded ${b.status === 'confirmed' ? 'bg-green-900 text-green-300' : 'bg-yellow-900 text-yellow-300'}`}>
                                    {b.status === 'confirmed' ? 'OK' : 'WAIT'}
                                </div>
                            </div>
                        ))}
                    </div>

                    {showPrice && (
                        <div className="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4" onClick={() => setShowPrice(false)}>
                            <div className="cyber-card p-6 w-full max-w-sm" onClick={e => e.stopPropagation()}>
                                <h3 className="text-xl font-bold text-center mb-4 font-header text-pink-500">–ü–†–ê–ô–°-–õ–ò–°–¢</h3>
                                <div className="space-y-3">
                                    {PRICES.map((p, i) => (
                                        <div key={i} className="flex justify-between border-b border-gray-800 pb-2">
                                            <span className="text-sm text-white">{p.name}</span>
                                            <span className="text-sm text-cyan-400 font-bold">{p.price}</span>
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => setShowPrice(false)} className="w-full mt-6 py-3 bg-gray-800 rounded text-white text-sm">–ó–ê–ö–†–´–¢–¨</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        if (view === 'booking') {
            return (
                <div className="min-h-screen p-4 pb-10 max-w-md mx-auto fade-in">
                    <button onClick={() => setView('client')} className="mb-4 text-gray-500 text-sm">‚Üê –ù–ê–ó–ê–î</button>
                    <h2 className="text-2xl font-bold mb-6 font-header text-white">–ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨</h2>
                    
                    <div className="mb-6">
                        <h3 className="text-cyan-400 text-xs font-bold mb-2 uppercase">1. –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</h3>
                        <div className="flex flex-wrap gap-2">
                            {['–ú–∞–Ω–∏–∫—é—Ä', '–ü–µ–¥–∏–∫—é—Ä', '–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ', '–°–Ω—è—Ç–∏–µ'].map(s => (
                                <button key={s} onClick={() => setSelectedService(s)} 
                                    className={`px-4 py-2 rounded-full text-sm border ${selectedService === s ? 'bg-pink-600 border-pink-600 text-white' : 'bg-transparent border-gray-600 text-gray-400'}`}>
                                    {s}
                                </button>
                            ))}
                        </div>
                    </div>

                    <h3 className="text-cyan-400 text-xs font-bold mb-3 uppercase">2. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h3>
                    {loading && <div className="loader mx-auto mb-4"></div>}
                    <div className="space-y-4">
                        {Object.entries(schedule).map(([day, times]) => (
                            <div key={day} className="bg-gray-900 p-4 rounded-xl border border-gray-800">
                                <h3 className="font-bold text-pink-500 mb-3">{day}</h3>
                                <div className="grid grid-cols-4 gap-2">
                                    {times.map(time => {
                                        const isBusy = bookings.some(b => b && b.day === day && b.time === time);
                                        return (
                                            <button key={time} disabled={isBusy} onClick={() => createBooking(day, time)} 
                                                className={`py-2 rounded text-xs font-bold transition ${isBusy ? 'bg-gray-800 text-gray-600 cursor-not-allowed' : 'bg-cyan-900/30 text-cyan-400 border border-cyan-800 hover:bg-cyan-500 hover:text-white'}`}>
                                                {time}
                                            </button>
                                        )
                                    })}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        if (view === 'admin') {
            const pending = bookings.filter(b => b && b.status === 'pending');
            return (
                <div className="min-h-screen p-4 bg-gray-900 text-white max-w-md mx-auto fade-in">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold font-header text-pink-500">ADMIN TERMINAL</h2>
                        <div className="flex gap-4 items-center">
                            {loading && <div className="loader"></div>}
                            <button onClick={() => setView('login')} className="text-xs text-gray-400">EXIT</button>
                        </div>
                    </div>

                    <div className="mb-8">
                        <h3 className="text-yellow-400 font-bold mb-3 text-sm">‚ö° –ù–û–í–´–ï –ó–ê–Ø–í–ö–ò ({pending.length})</h3>
                        <button onClick={fetchBookings} className="text-xs text-cyan-400 mb-3 underline">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                        
                        <div className="space-y-3">
                            {pending.length === 0 && <p className="text-gray-600 text-sm">–ü—É—Å—Ç–æ...</p>}
                            {pending.map(b => (
                                <div key={b.id} className="bg-gray-800 p-4 rounded-xl border border-gray-700 relative">
                                    <button onClick={() => {if(confirm('–£–¥–∞–ª–∏—Ç—å?')) updateBookingStatus(b.id, 'delete')}} className="absolute top-2 right-2 text-red-500 p-2"><Icon name="trash"/></button>
                                    
                                    <div className="pr-8 mb-3">
                                        <p className="font-bold text-lg text-white">{b.name}</p>
                                        <p className="text-xs text-pink-400 font-bold mb-1">{b.service}</p>
                                        
                                        <div className="flex items-center gap-2 mb-1">
                                            <p className="text-sm text-cyan-300">üìû {b.phone}</p>
                                            <a href={getTelegramLink(b.phone)} target="_blank" className="btn-telegram">
                                                <Icon name="telegram"/> –ß–∞—Ç
                                            </a>
                                        </div>

                                        <p className="text-xs text-gray-400 mb-2">{b.address}</p> 
                                        <div className="bg-gray-700 inline-block px-2 py-1 rounded text-sm font-mono text-white">üìÖ {b.day} ‚Äî {b.time}</div>
                                    </div>
                                    
                                    <button onClick={() => updateBookingStatus(b.id, 'confirm')} className="w-full mt-3 py-2 bg-green-600 hover:bg-green-500 rounded font-bold shadow text-sm">
                                        –ü–û–î–¢–í–ï–†–î–ò–¢–¨
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
